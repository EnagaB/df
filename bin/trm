#!/bin/bash
set -u

usage="
Move files to trash box

Usage:
  > trm [FILE]...

The path of trash box is defined as environment variable TRASHCAN."

n_args="$#"
if [ "$n_args" -eq 0 ]; then
    echo "ERROR: Number of arguments is 0."
    echo "$usage"
    exit 1
fi

trash_can="${TRASHCAN:-""}"
if [ -z "$trash_can" ]; then
    echo "ERROR: trash can (TRASHCAN) is not defined"
    echo "$usage"
    exit 1
fi
[ ! -d "$trash_can" ] && mkdir -p "$trash_can"

for trash_file in "$@" ; do
    trash_filename=$(basename "$trash_file")
    trash_path="${trash_can}/${trash_filename}"
    if [ -e "$trash_path" ]; then
        n_ver=1
        org_trash_path="$trash_path"
        while true; do
            trash_path="${org_trash_path}.${n_ver}"
            [ ! -e "$trash_path" ] && break
            n_ver=$(($n_ver+1))
        done
    fi
    mv "$trash_file" "$trash_path"
done
