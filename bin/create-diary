#!/usr/bin/env python3
# coding: utf-8

import sys
import argparse
import datetime
from pathlib import Path

def add_arguments(parser):
    parser.add_argument("output_dir", type=Path,
                        help="""output dirctory.
                        The diary paths are output_dir/year/mmdd-mmdd.md ...""")
    parser.add_argument("year", type=int,
                        help="year")
    return parser

def main(args):
    if args.year < 2020 or args.year > 2100:
        msg = f"year {args.year} is wrong."
        raise RuntimeError(msg)
    new_year_day = datetime.date.fromisoformat(str(args.year) + '-01-01')
    year_dir = args.output_dir / str(args.year)
    year_dir.mkdir(parents=True, exist_ok=True)
    # Monday set
    first_day = new_year_day
    while first_day.weekday() != 0:
        first_day += datetime.timedelta(days=1)
    # create weekly diary
    while first_day.year == args.year:
        first_day_str = first_day.strftime("%m%d")
        weekend_str = (first_day + datetime.timedelta(days=6)).strftime("%m%d")
        week_diary = year_dir / f"{first_day_str}-{weekend_str}.md"
        with week_diary.open(mode="w") as ofile:
            for i in range(7):
                weekday = first_day + datetime.timedelta(days=i)
                weekday_str = weekday.strftime("%Y/%m/%d (%A)")
                ofile.write(f"# {weekday_str}\n\n")
            ofile.write(f"# note\n\n")
        first_day += datetime.timedelta(days=7)

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="""Create diary""")
    parser = add_arguments(parser)
    sys.exit(main(parser.parse_args()))
